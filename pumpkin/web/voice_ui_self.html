<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Self Awareness Console</title>
    <link rel="icon" href="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><rect x='29' y='10' width='6' height='12' fill='%235b4b41'/><circle cx='32' cy='36' r='20' fill='%23e67c2e'/><circle cx='20' cy='36' r='14' fill='%23f08a3a' opacity='0.85'/><circle cx='44' cy='36' r='14' fill='%23f08a3a' opacity='0.85'/></svg>" />
    <style>
      :root {
        --bg: #f6efe8;
        --bg-accent: #f2d6b5;
        --ink: #2a1b12;
        --muted: #5b4b41;
        --pumpkin: #e67c2e;
        --pumpkin-dark: #b95519;
        --card: #fff8f2;
        --line: #e5d6c6;
      }
      * { box-sizing: border-box; }
      body {
        margin: 0;
        font-family: "Iowan Old Style", "Palatino", "Bookman", "Georgia", serif;
        color: var(--ink);
        background:
          radial-gradient(circle at 10% 10%, rgba(230, 124, 46, 0.16), transparent 40%),
          linear-gradient(160deg, var(--bg), var(--bg-accent));
        min-height: 100vh;
      }
      header {
        padding: 28px 24px 12px;
        display: flex;
        flex-direction: column;
        gap: 6px;
      }
      .title {
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 26px;
        font-weight: 700;
      }
      .sub { color: var(--muted); }
      main {
        padding: 12px 24px 40px;
        display: grid;
        gap: 16px;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      }
      .card {
        background: var(--card);
        border: 1px solid var(--line);
        border-radius: 16px;
        padding: 16px;
        box-shadow: 0 12px 32px rgba(50, 33, 22, 0.08);
        display: grid;
        gap: 10px;
      }
      .section-title {
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: var(--muted);
      }
      .stat {
        font-size: 22px;
        font-weight: 700;
      }
      .list {
        margin: 0;
        padding: 0;
        list-style: none;
        display: grid;
        gap: 6px;
        color: var(--muted);
        font-size: 12px;
      }
    </style>
  </head>
  <body>
    <header>
      <div class="title">Self Awareness Console</div>
      <div class="sub">
        Live state vector and causal reasoning.
        <a href="/ui">Back to dashboard →</a>
      </div>
    </header>
    <main>
      <section class="card">
        <div class="section-title">State Vector</div>
        <div class="stat" id="self-confidence">confidence --</div>
        <div class="sub" id="self-narrative">Awaiting narrative...</div>
        <div class="sub" id="self-counter">Counterfactual: n/a</div>
        <ul class="list" id="self-details"></ul>
      </section>
      <section class="card">
        <div class="section-title">Learning Focus</div>
        <ul class="list" id="self-focus"></ul>
      </section>
      <section class="card">
        <div class="section-title">Evolution Timeline</div>
        <ul class="list" id="self-evolution"></ul>
      </section>
      <section class="card">
        <div class="section-title">Confidence Trend</div>
        <ul class="list" id="self-history"></ul>
      </section>
      <section class="card">
        <div class="section-title">Self Journal</div>
        <ul class="list" id="self-journal"></ul>
      </section>
      <section class="card">
        <div class="section-title">Causal Trace</div>
        <ul class="list">
          <li><a href="/ui/trace">Open causal trace viewer →</a></li>
          <li>Tracks observation → decision → action → outcome.</li>
        </ul>
      </section>
    </main>
    <script>
      const qs = (id) => document.getElementById(id);
      const setText = (node, text) => { if (node) node.textContent = text; };
      const setList = (node, items) => {
        if (!node) return;
        node.innerHTML = "";
        if (!items.length) return;
        items.forEach((item) => {
          const li = document.createElement("li");
          li.textContent = item;
          node.appendChild(li);
        });
      };

      const load = async () => {
        const res = await fetch("/summary");
        const summary = await res.json();
        const selfModel = summary.self_model || {};
        const selfNarr = summary.self_narrative || {};
        const confidence = selfModel.confidence != null ? Math.round(selfModel.confidence * 100) : "--";
        setText(qs("self-confidence"), `confidence ${confidence}%`);
        setText(qs("self-narrative"), selfNarr.observed ? `Observed: ${selfNarr.observed} • Decided: ${selfNarr.decided || "n/a"}` : "Awaiting narrative...");
        const counter = Array.isArray(selfNarr.counterfactuals) ? selfNarr.counterfactuals : [];
        setText(qs("self-counter"), counter.length ? `Counterfactual: ${counter[0]}` : "Counterfactual: n/a");
        setList(qs("self-details"), [
          `mode: ${selfModel.mode || "OPERATOR"}`,
          `insights: ${selfModel.insights ?? 0}`,
          `detections: ${selfModel.detections ?? 0}`,
          `auto actions: ${selfModel.auto_actions ?? 0}`,
          `proposals: ${selfModel.proposals ?? 0}`,
          `warnings: ${selfModel.warnings ?? 0}`,
          `uncertainty: ${selfModel.uncertainty != null ? Math.round(selfModel.uncertainty * 100) + "%" : "n/a"}`,
          `goal alignment: ${selfModel.goal_alignment != null ? Math.round(selfModel.goal_alignment * 100) + "%" : "n/a"}`,
        ]);
        const focus = Array.isArray(selfModel.focus) ? selfModel.focus : [];
        setList(qs("self-focus"), focus.map((item) => `focus: ${item}`));
        const evolution = Array.isArray(summary.evolution_timeline) ? summary.evolution_timeline : [];
        const evoItems = evolution.map((entry) => {
          const gained = entry.gained || {};
          const lost = entry.lost || {};
          const gainedCount = (gained.ha_domains || []).length + (gained.cameras || []).length + (gained.modules || []).length;
          const lostCount = (lost.ha_domains || []).length + (lost.cameras || []).length + (lost.modules || []).length;
          return `${entry.ts} • +${gainedCount} / -${lostCount}`;
        });
        setList(qs("self-evolution"), evoItems);
        const history = Array.isArray(summary.self_history) ? summary.self_history : [];
        const historyItems = history.map((row) => {
          const conf = row.confidence != null ? Math.round(row.confidence * 100) + "%" : "n/a";
          const warn = row.warnings ?? 0;
          return `${row.ts} • ${conf} • warnings ${warn}`;
        });
        setList(qs("self-history"), historyItems);
        const journal = Array.isArray(summary.self_journal) ? summary.self_journal : [];
        const journalItems = journal.map((entry) => {
          return `${entry.ts} • ${entry.summary || "reflection"}`;
        });
        setList(qs("self-journal"), journalItems);
      };
      load();
    </script>
  </body>
</html>
