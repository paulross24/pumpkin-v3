version: 1
modules:
  - name: homeassistant.observer
    type: observer
    description: Ingests state and event data from Home Assistant for richer context.
    config_schema:
      type: object
      properties:
        base_url:
          type: string
        verify_tls:
          type: boolean
        token_env:
          type: string
      required:
        - base_url
    safety_level: med
    prerequisites:
      packages: []
      services:
        - home-assistant
      network_access:
        - http://192.168.1.140
    provides:
      - source: homeassistant
        signals:
          - entity.state
          - event
  - name: code.assistant
    type: capability
    description: Draft code changes and reviewable patches with human approval.
    config_schema:
      type: object
      properties:
        repo_root:
          type: string
        require_approval:
          type: boolean
      required:
        - repo_root
    safety_level: high
    prerequisites:
      packages: []
      services: []
      network_access: []
    provides:
      - source: code
        signals:
          - patch.proposed
          - patch.reviewed
  - name: network.discovery
    type: observer
    description: Discover active devices on the local network for capability planning.
    config_schema:
      type: object
      properties:
        subnet:
          type: string
        tcp_ports:
          type: array
          items:
            type: integer
        timeout_seconds:
          type: number
        max_hosts:
          type: integer
      required: []
    safety_level: med
    prerequisites:
      packages: []
      services: []
      network_access:
        - lan
    provides:
      - source: network
        signals:
          - device.discovered

  - name: face.recognition
    type: capability
    description: Run face recognition on camera feeds and emit recognition events.
    config_schema:
      type: object
      properties:
        enabled:
          type: boolean
        scan_interval_seconds:
          type: integer
        max_cameras_per_run:
          type: integer
        timeout_seconds:
          type: number
        ffmpeg_path:
          type: string
        provider:
          type: object
        cameras:
          type: array
      required: []
    safety_level: high
    prerequisites:
      packages: []
      services:
        - camera
      network_access: []
    provides:
      - source: vision
        signals:
          - person.recognized
          - face.unknown

  - name: voice.mic_rtsp
    type: capability
    description: Capture RTSP camera audio and forward voice commands into Pumpkin.
    config_schema:
      type: object
      properties:
        enabled:
          type: boolean
        camera_id:
          type: string
        rtsp_url:
          type: string
        capture_seconds:
          type: number
        poll_interval_seconds:
          type: integer
        cooldown_seconds:
          type: integer
        threshold_db:
          type: number
        sample_rate:
          type: integer
        channels:
          type: integer
        wake_words:
          type: array
          items:
            type: string
        min_chars:
          type: integer
        ffmpeg_path:
          type: string
        wake_beep:
          type: object
          properties:
            enabled:
              type: boolean
            frequency_hz:
              type: number
            duration_ms:
              type: integer
            volume:
              type: number
            aplay_path:
              type: string
      required: []
    safety_level: med
    prerequisites:
      packages: []
      services:
        - camera
      network_access: []
    provides:
      - source: voice
        signals:
          - voice.mic_forwarded

  - name: insights
    type: observer
    description: Generate insight events and briefing summaries from system signals.
    config_schema:
      type: object
      properties:
        briefing_times:
          type: array
          items:
            type: string
        auto_notify_types:
          type: array
          items:
            type: string
      required: []
    safety_level: low
    prerequisites:
      packages: []
      services: []
      network_access: []
    provides:
      - source: insight
        signals:
          - insight.generated
          - insight.briefing

  - name: selfheal
    type: capability
    description: Execute safe recovery actions when health checks fail.
    config_schema:
      type: object
      properties:
        enabled:
          type: boolean
        cooldown_seconds:
          type: integer
      required: []
    safety_level: med
    prerequisites:
      packages: []
      services: []
      network_access: []
    provides:
      - source: ops
        signals:
          - selfheal.action
